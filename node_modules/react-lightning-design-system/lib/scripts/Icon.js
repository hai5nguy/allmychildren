'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});

var _slicedToArray2 = require('babel-runtime/helpers/slicedToArray');

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _extends2 = require('babel-runtime/helpers/extends');

var _extends3 = _interopRequireDefault(_extends2);

var _defineProperty2 = require('babel-runtime/helpers/defineProperty');

var _defineProperty3 = _interopRequireDefault(_defineProperty2);

var _objectWithoutProperties2 = require('babel-runtime/helpers/objectWithoutProperties');

var _objectWithoutProperties3 = _interopRequireDefault(_objectWithoutProperties2);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

var _react = require('react');

var _react2 = _interopRequireDefault(_react);

var _reactDom = require('react-dom');

var _reactDom2 = _interopRequireDefault(_reactDom);

var _classnames2 = require('classnames');

var _classnames3 = _interopRequireDefault(_classnames2);

var _svg4everybody = require('svg4everybody');

var _svg4everybody2 = _interopRequireDefault(_svg4everybody);

var _util = require('./util');

var _util2 = _interopRequireDefault(_util);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

(0, _svg4everybody2.default)();

var Icon = function (_React$Component) {
  (0, _inherits3.default)(Icon, _React$Component);

  function Icon(props) {
    (0, _classCallCheck3.default)(this, Icon);

    var _this = (0, _possibleConstructorReturn3.default)(this, (0, _getPrototypeOf2.default)(Icon).call(this, props));

    _this.state = {};
    return _this;
  }

  (0, _createClass3.default)(Icon, [{
    key: 'componentDidMount',
    value: function componentDidMount() {
      this.checkIconColor();
      var svgEl = _reactDom2.default.findDOMNode(this.refs.svgIcon);
      svgEl.setAttribute('focusable', this.props.tabIndex >= 0);
    }
  }, {
    key: 'componentDidUpdate',
    value: function componentDidUpdate() {
      this.checkIconColor();
    }
  }, {
    key: 'getIconColor',
    value: function getIconColor(fillColor, category, icon) {
      return this.state.iconColor ? this.state.iconColor : category === 'doctype' ? null : fillColor === 'none' ? null : fillColor ? fillColor : category === 'utility' ? null : category === 'custom' ? icon.replace(/^custom/, 'custom-') : category === 'action' && /^new_custom/.test(icon) ? icon.replace(/^new_custom/, 'custom-') : category + '-' + (icon || '').replace(/_/g, '-');
    }
  }, {
    key: 'checkIconColor',
    value: function checkIconColor() {
      var _props = this.props;
      var fillColor = _props.fillColor;
      var _props$category = _props.category;
      var category = _props$category === undefined ? 'utility' : _props$category;
      var container = _props.container;

      if (fillColor === 'none' || category === 'doctype' || !fillColor && category === 'utility') {
        return;
      }
      var el = _reactDom2.default.findDOMNode(container ? this.refs.iconContainer : this.refs.svgIcon);
      if (!el) {
        return;
      }
      var bgColorStyle = getComputedStyle(el)['background-color'];
      if (/^(transparent|rgba\(0,\s*0,\s*0,\s*0\))$/.test(bgColorStyle)) {
        // if no background color set to the icon
        this.setState({ iconColor: 'standard-default' });
      }
    }
  }, {
    key: 'renderSVG',
    value: function renderSVG(_ref) {
      var _classnames;

      var className = _ref.className;
      var _ref$category = _ref.category;
      var category = _ref$category === undefined ? 'utility' : _ref$category;
      var icon = _ref.icon;
      var size = _ref.size;
      var align = _ref.align;
      var fillColor = _ref.fillColor;
      var container = _ref.container;
      var _ref$textColor = _ref.textColor;
      var textColor = _ref$textColor === undefined ? 'default' : _ref$textColor;
      var props = (0, _objectWithoutProperties3.default)(_ref, ['className', 'category', 'icon', 'size', 'align', 'fillColor', 'container', 'textColor']);

      var iconColor = this.getIconColor(fillColor, category, icon);
      var iconClassNames = (0, _classnames3.default)((_classnames = {
        'slds-icon': !/slds\-button__icon/.test(className)
      }, (0, _defineProperty3.default)(_classnames, 'slds-icon--' + size, /^(x-small|small|large)$/.test(size)), (0, _defineProperty3.default)(_classnames, 'slds-icon--' + align, /^(left|right)$/.test(align)), (0, _defineProperty3.default)(_classnames, 'slds-icon-text-' + textColor, /^(default|warning|error)$/.test(textColor) && !container && !iconColor), (0, _defineProperty3.default)(_classnames, 'slds-icon-' + iconColor, !container && iconColor), _classnames), className);
      var useHtml = '<use xlink:href="' + _util2.default.getAssetRoot() + '/icons/' + category + '-sprite/svg/symbols.svg#' + icon + '"></use>';
      return _react2.default.createElement('svg', (0, _extends3.default)({ className: iconClassNames,
        'aria-hidden': true,
        dangerouslySetInnerHTML: { __html: useHtml },
        ref: 'svgIcon'
      }, props));
    }
  }, {
    key: 'render',
    value: function render() {
      var _props2 = this.props;
      var container = _props2.container;
      var props = (0, _objectWithoutProperties3.default)(_props2, ['container']);
      var category = props.category;
      var icon = props.icon;


      if (icon.indexOf(':') > 0) {
        var _icon$split = icon.split(':');

        var _icon$split2 = (0, _slicedToArray3.default)(_icon$split, 2);

        category = _icon$split2[0];
        icon = _icon$split2[1];
      }
      if (container) {
        var className = props.className;
        var fillColor = props.fillColor;
        var pprops = (0, _objectWithoutProperties3.default)(props, ['className', 'fillColor']);

        var iconColor = this.getIconColor(fillColor, category, icon);
        var containerClassName = (0, _classnames3.default)('slds-icon__container', container === 'circle' ? 'slds-icon__container--circle' : null, iconColor ? 'slds-icon-' + iconColor : null, className);
        return _react2.default.createElement(
          'span',
          { className: containerClassName, ref: 'iconContainer' },
          this.renderSVG((0, _extends3.default)({ category: category, icon: icon, fillColor: iconColor, container: container }, pprops))
        );
      }

      return this.renderSVG((0, _extends3.default)({}, props, { category: category, icon: icon }));
    }
  }]);
  return Icon;
}(_react2.default.Component);

exports.default = Icon;


Icon.propTypes = {
  className: _react.PropTypes.string,
  category: _react.PropTypes.oneOf(['action', 'custom', 'doctype', 'standard', 'utility']),
  icon: _react.PropTypes.string,
  container: _react.PropTypes.oneOfType([_react.PropTypes.bool, _react.PropTypes.oneOf(['default', 'circle'])]),
  color: _react.PropTypes.string,
  textColor: _react.PropTypes.oneOf(['default', 'warning', 'error']),
  tabIndex: _react.PropTypes.number,
  fillColor: _react.PropTypes.string
};
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9zY3JpcHRzL0ljb24uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQU1BOztJQUVxQjs7O0FBQ25CLFdBRG1CLElBQ25CLENBQVksS0FBWixFQUFtQjt3Q0FEQSxNQUNBOzs2RkFEQSxpQkFFWCxRQURXOztBQUVqQixVQUFLLEtBQUwsR0FBYSxFQUFiLENBRmlCOztHQUFuQjs7NkJBRG1COzt3Q0FNQztBQUNsQixXQUFLLGNBQUwsR0FEa0I7QUFFbEIsVUFBTSxRQUFRLG1CQUFTLFdBQVQsQ0FBcUIsS0FBSyxJQUFMLENBQVUsT0FBVixDQUE3QixDQUZZO0FBR2xCLFlBQU0sWUFBTixDQUFtQixXQUFuQixFQUFnQyxLQUFLLEtBQUwsQ0FBVyxRQUFYLElBQXVCLENBQXZCLENBQWhDLENBSGtCOzs7O3lDQU1DO0FBQ25CLFdBQUssY0FBTCxHQURtQjs7OztpQ0FJUixXQUFXLFVBQVUsTUFBTTtBQUN0QyxhQUNFLEtBQUssS0FBTCxDQUFXLFNBQVgsR0FBdUIsS0FBSyxLQUFMLENBQVcsU0FBWCxHQUN2QixhQUFhLFNBQWIsR0FBeUIsSUFBekIsR0FDQSxjQUFjLE1BQWQsR0FBdUIsSUFBdkIsR0FDQSxZQUFZLFNBQVosR0FDQSxhQUFhLFNBQWIsR0FBeUIsSUFBekIsR0FDQSxhQUFhLFFBQWIsR0FBd0IsS0FBSyxPQUFMLENBQWEsU0FBYixFQUF3QixTQUF4QixDQUF4QixHQUNBLGFBQWEsUUFBYixJQUF5QixjQUFjLElBQWQsQ0FBbUIsSUFBbkIsQ0FBekIsR0FBb0QsS0FBSyxPQUFMLENBQWEsYUFBYixFQUE0QixTQUE1QixDQUFwRCxHQUNBLFdBQVcsR0FBWCxHQUFpQixDQUFDLFFBQVEsRUFBUixDQUFELENBQWEsT0FBYixDQUFxQixJQUFyQixFQUEyQixHQUEzQixDQUFqQixDQVRvQzs7OztxQ0FhdkI7bUJBQ3dD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QkFBTSxTQUFOOztrQkFBYjs7O0FBNEZyQixLQUFLLFNBQUwsR0FBaUI7QUFDZixhQUFXLGlCQUFVLE1BQVY7QUFDWCxZQUFVLGlCQUFVLEtBQVYsQ0FBZ0IsQ0FBQyxRQUFELEVBQVcsUUFBWCxFQUFxQixTQUFyQixFQUFnQyxVQUFoQyxFQUE0QyxTQUE1QyxDQUFoQixDQUFWO0FBQ0EsUUFBTSxpQkFBVSxNQUFWO0FBQ04sYUFBVyxpQkFBVSxTQUFWLENBQW9CLENBQzdCLGlCQUFVLElBQVYsRUFDQSxpQkFBVSxLQUFWLENBQWdCLENBQUMsU0FBRCxFQUFZLFFBQVosQ0FBaEIsQ0FGNkIsQ0FBcEIsQ0FBWDtBQUlBLFNBQU8saUJBQVUsTUFBVjtBQUNQLGFBQVcsaUJBQVUsS0FBVixDQUFnQixDQUFDLFNBQUQsRUFBWSxTQUFaLEVBQXVCLE9BQXZCLENBQWhCLENBQVg7QUFDQSxZQUFVLGlCQUFVLE1BQVY7QUFDVixhQUFXLGlCQUFVLE1BQVY7Q0FYYiIsImZpbGUiOiJJY29uLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7IFByb3BUeXBlcyB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBSZWFjdERPTSBmcm9tICdyZWFjdC1kb20nO1xuaW1wb3J0IGNsYXNzbmFtZXMgZnJvbSAnY2xhc3NuYW1lcyc7XG5pbXBvcnQgc3ZnNGV2ZXJ5Ym9keSBmcm9tICdzdmc0ZXZlcnlib2R5JztcbmltcG9ydCB1dGlsIGZyb20gJy4vdXRpbCc7XG5cbnN2ZzRldmVyeWJvZHkoKTtcblxuZXhwb3J0IGRlZmF1bHQgY2xhc3MgSWNvbiBleHRlbmRzIFJlYWN0LkNvbXBvbmVudCB7XG4gIGNvbnN0cnVjdG9yKHByb3BzKSB7XG4gICAgc3VwZXIocHJvcHMpO1xuICAgIHRoaXMuc3RhdGUgPSB7fTtcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIHRoaXMuY2hlY2tJY29uQ29sb3IoKTtcbiAgICBjb25zdCBzdmdFbCA9IFJlYWN0RE9NLmZpbmRET01Ob2RlKHRoaXMucmVmcy5zdmdJY29uKTtcbiAgICBzdmdFbC5zZXRBdHRyaWJ1dGUoJ2ZvY3VzYWJsZScsIHRoaXMucHJvcHMudGFiSW5kZXggPj0gMCk7XG4gIH1cblxuICBjb21wb25lbnREaWRVcGRhdGUoKSB7XG4gICAgdGhpcy5jaGVja0ljb25Db2xvcigpO1xuICB9XG5cbiAgZ2V0SWNvbkNvbG9yKGZpbGxDb2xvciwgY2F0ZWdvcnksIGljb24pIHtcbiAgICByZXR1cm4gKFxuICAgICAgdGhpcy5zdGF0ZS5pY29uQ29sb3IgPyB0aGlzLnN0YXRlLmljb25Db2xvciA6XG4gICAgICBjYXRlZ29yeSA9PT0gJ2RvY3R5cGUnID8gbnVsbCA6XG4gICAgICBmaWxsQ29sb3IgPT09ICdub25lJyA/IG51bGwgOlxuICAgICAgZmlsbENvbG9yID8gZmlsbENvbG9yIDpcbiAgICAgIGNhdGVnb3J5ID09PSAndXRpbGl0eScgPyBudWxsIDpcbiAgICAgIGNhdGVnb3J5ID09PSAnY3VzdG9tJyA/IGljb24ucmVwbGFjZSgvXmN1c3RvbS8sICdjdXN0b20tJykgOlxuICAgICAgY2F0ZWdvcnkgPT09ICdhY3Rpb24nICYmIC9ebmV3X2N1c3RvbS8udGVzdChpY29uKSA/IGljb24ucmVwbGFjZSgvXm5ld19jdXN0b20vLCAnY3VzdG9tLScpIDpcbiAgICAgIGNhdGVnb3J5ICsgJy0nICsgKGljb24gfHwgJycpLnJlcGxhY2UoL18vZywgJy0nKVxuICAgICk7XG4gIH1cblxuICBjaGVja0ljb25Db2xvcigpIHtcbiAgICBjb25zdCB7IGZpbGxDb2xvciwgY2F0ZWdvcnkgPSAndXRpbGl0eScsIGNvbnRhaW5lciB9ID0gdGhpcy5wcm9wcztcbiAgICBpZiAoZmlsbENvbG9yID09PSAnbm9uZScgfHwgY2F0ZWdvcnkgPT09ICdkb2N0eXBlJyB8fCAoIWZpbGxDb2xvciAmJiBjYXRlZ29yeSA9PT0gJ3V0aWxpdHknKSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICBjb25zdCBlbCA9IFJlYWN0RE9NLmZpbmRET01Ob2RlKGNvbnRhaW5lciA/IHRoaXMucmVmcy5pY29uQ29udGFpbmVyIDogdGhpcy5yZWZzLnN2Z0ljb24pO1xuICAgIGlmICghZWwpIHsgcmV0dXJuOyB9XG4gICAgY29uc3QgYmdDb2xvclN0eWxlID0gZ2V0Q29tcHV0ZWRTdHlsZShlbClbJ2JhY2tncm91bmQtY29sb3InXTtcbiAgICBpZiAoL14odHJhbnNwYXJlbnR8cmdiYVxcKDAsXFxzKjAsXFxzKjAsXFxzKjBcXCkpJC8udGVzdChiZ0NvbG9yU3R5bGUpKSB7IC8vIGlmIG5vIGJhY2tncm91bmQgY29sb3Igc2V0IHRvIHRoZSBpY29uXG4gICAgICB0aGlzLnNldFN0YXRlKHsgaWNvbkNvbG9yOiAnc3RhbmRhcmQtZGVmYXVsdCcgfSk7XG4gICAgfVxuICB9XG5cbiAgcmVuZGVyU1ZHKHsgY2xhc3NOYW1lLCBjYXRlZ29yeSA9ICd1dGlsaXR5JywgaWNvbiwgc2l6ZSwgYWxpZ24sIGZpbGxDb2xvciwgY29udGFpbmVyLCB0ZXh0Q29sb3IgPSAnZGVmYXVsdCcsIC4uLnByb3BzIH0pIHtcbiAgICBjb25zdCBpY29uQ29sb3IgPSB0aGlzLmdldEljb25Db2xvcihmaWxsQ29sb3IsIGNhdGVnb3J5LCBpY29uKTtcbiAgICBjb25zdCBpY29uQ2xhc3NOYW1lcyA9IGNsYXNzbmFtZXMoXG4gICAgICB7XG4gICAgICAgICdzbGRzLWljb24nOiAhL3NsZHNcXC1idXR0b25fX2ljb24vLnRlc3QoY2xhc3NOYW1lKSxcbiAgICAgICAgW2BzbGRzLWljb24tLSR7c2l6ZX1gXTogL14oeC1zbWFsbHxzbWFsbHxsYXJnZSkkLy50ZXN0KHNpemUpLFxuICAgICAgICBbYHNsZHMtaWNvbi0tJHthbGlnbn1gXTogL14obGVmdHxyaWdodCkkLy50ZXN0KGFsaWduKSxcbiAgICAgICAgW2BzbGRzLWljb24tdGV4dC0ke3RleHRDb2xvcn1gXTogL14oZGVmYXVsdHx3YXJuaW5nfGVycm9yKSQvLnRlc3QodGV4dENvbG9yKSAmJiAhY29udGFpbmVyICYmICFpY29uQ29sb3IsXG4gICAgICAgIFtgc2xkcy1pY29uLSR7aWNvbkNvbG9yfWBdOiAhY29udGFpbmVyICYmIGljb25Db2xvcixcbiAgICAgIH0sXG4gICAgICBjbGFzc05hbWVcbiAgICApO1xuICAgIGNvbnN0IHVzZUh0bWwgPSBgPHVzZSB4bGluazpocmVmPVwiJHsgdXRpbC5nZXRBc3NldFJvb3QoKSB9L2ljb25zLyR7Y2F0ZWdvcnl9LXNwcml0ZS9zdmcvc3ltYm9scy5zdmcjJHtpY29ufVwiPjwvdXNlPmA7XG4gICAgcmV0dXJuIChcbiAgICAgIDxzdmcgY2xhc3NOYW1lPXsgaWNvbkNsYXNzTmFtZXMgfVxuICAgICAgICBhcmlhLWhpZGRlblxuICAgICAgICBkYW5nZXJvdXNseVNldElubmVySFRNTD17IHsgX19odG1sOiB1c2VIdG1sIH0gfVxuICAgICAgICByZWY9J3N2Z0ljb24nXG4gICAgICAgIHsuLi5wcm9wc31cbiAgICAgIC8+XG4gICAgKTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBjb25zdCB7IGNvbnRhaW5lciwgLi4ucHJvcHMgfSA9IHRoaXMucHJvcHM7XG4gICAgbGV0IHsgY2F0ZWdvcnksIGljb24gfSA9IHByb3BzO1xuXG4gICAgaWYgKGljb24uaW5kZXhPZignOicpID4gMCkge1xuICAgICAgW2NhdGVnb3J5LCBpY29uXSA9IGljb24uc3BsaXQoJzonKTtcbiAgICB9XG4gICAgaWYgKGNvbnRhaW5lcikge1xuICAgICAgY29uc3QgeyBjbGFzc05hbWUsIGZpbGxDb2xvciwgLi4ucHByb3BzIH0gPSBwcm9wcztcbiAgICAgIGNvbnN0IGljb25Db2xvciA9IHRoaXMuZ2V0SWNvbkNvbG9yKGZpbGxDb2xvciwgY2F0ZWdvcnksIGljb24pO1xuICAgICAgY29uc3QgY29udGFpbmVyQ2xhc3NOYW1lID0gY2xhc3NuYW1lcyhcbiAgICAgICAgJ3NsZHMtaWNvbl9fY29udGFpbmVyJyxcbiAgICAgICAgY29udGFpbmVyID09PSAnY2lyY2xlJyA/ICdzbGRzLWljb25fX2NvbnRhaW5lci0tY2lyY2xlJyA6IG51bGwsXG4gICAgICAgIGljb25Db2xvciA/IGBzbGRzLWljb24tJHtpY29uQ29sb3J9YCA6IG51bGwsXG4gICAgICAgIGNsYXNzTmFtZVxuICAgICAgKTtcbiAgICAgIHJldHVybiAoXG4gICAgICAgIDxzcGFuIGNsYXNzTmFtZT17IGNvbnRhaW5lckNsYXNzTmFtZSB9IHJlZj0naWNvbkNvbnRhaW5lcic+XG4gICAgICAgICAgeyB0aGlzLnJlbmRlclNWRyh7IGNhdGVnb3J5LCBpY29uLCBmaWxsQ29sb3I6IGljb25Db2xvciwgY29udGFpbmVyLCAuLi5wcHJvcHMgfSkgfVxuICAgICAgICA8L3NwYW4+XG4gICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLnJlbmRlclNWRyh7IC4uLnByb3BzLCBjYXRlZ29yeSwgaWNvbiB9KTtcbiAgfVxufVxuXG5JY29uLnByb3BUeXBlcyA9IHtcbiAgY2xhc3NOYW1lOiBQcm9wVHlwZXMuc3RyaW5nLFxuICBjYXRlZ29yeTogUHJvcFR5cGVzLm9uZU9mKFsnYWN0aW9uJywgJ2N1c3RvbScsICdkb2N0eXBlJywgJ3N0YW5kYXJkJywgJ3V0aWxpdHknXSksXG4gIGljb246IFByb3BUeXBlcy5zdHJpbmcsXG4gIGNvbnRhaW5lcjogUHJvcFR5cGVzLm9uZU9mVHlwZShbXG4gICAgUHJvcFR5cGVzLmJvb2wsXG4gICAgUHJvcFR5cGVzLm9uZU9mKFsnZGVmYXVsdCcsICdjaXJjbGUnXSksXG4gIF0pLFxuICBjb2xvcjogUHJvcFR5cGVzLnN0cmluZyxcbiAgdGV4dENvbG9yOiBQcm9wVHlwZXMub25lT2YoWydkZWZhdWx0JywgJ3dhcm5pbmcnLCAnZXJyb3InXSksXG4gIHRhYkluZGV4OiBQcm9wVHlwZXMubnVtYmVyLFxuICBmaWxsQ29sb3I6IFByb3BUeXBlcy5zdHJpbmcsXG59O1xuIl19